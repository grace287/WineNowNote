{% extends "base.html" %}
{% block title %}íšŒì›ê°€ì… â€” WineNowNote{% endblock %}
{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="logo" style="text-align: center; margin-bottom: 1.5rem;">
            <h1 style="color: var(--wine-secondary); font-size: 1.75rem; font-weight: 700; margin-bottom: 0.25rem;">ğŸ· WineNowNote</h1>
            <p style="color: var(--text-secondary); font-size: 14px;">ì™€ì¸ ì‹œìŒ ì—¬ì •ì„ ì‹œì‘í•˜ì„¸ìš”</p>
        </div>
        <div class="social-login" style="display: flex; gap: 10px; margin-bottom: 1.25rem;">
            <button type="button" class="btn btn-secondary" style="flex:1; padding: 12px;" disabled>ì¹´ì¹´ì˜¤</button>
            <button type="button" class="btn btn-secondary" style="flex:1; padding: 12px;" disabled>êµ¬ê¸€</button>
            <button type="button" class="btn btn-secondary" style="flex:1; padding: 12px;" disabled>ë„¤ì´ë²„</button>
        </div>
        <div class="divider" style="text-align: center; margin: 1.25rem 0;">
            <span style="background: #fff; padding: 0 12px; color: var(--text-tertiary); font-size: 13px;">ë˜ëŠ” ì´ë©”ì¼ë¡œ ê°€ì…</span>
        </div>
        <div style="border-top: 1px solid var(--border); margin: 0 0 1.25rem;"></div>
        <div id="reg-error" class="alert alert-error" style="display: none;"></div>
        <form id="register-form">
            <div class="form-group">
                <label for="reg-email">ì´ë©”ì¼</label>
                <input type="email" id="reg-email" name="email" required placeholder="example@email.com" autocomplete="email">
            </div>
            <div class="form-group">
                <label for="reg-username">ë‹‰ë„¤ì„</label>
                <input type="text" id="reg-username" name="username" required placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„" autocomplete="username" minlength="2" maxlength="50">
            </div>
            <div class="form-group">
                <label for="reg-password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="reg-password" name="password" required placeholder="8ì ì´ìƒ ê¶Œì¥" autocomplete="new-password" minlength="8">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 0.25rem;">ê°€ì…í•˜ê¸°</button>
        </form>
        <p class="text-muted" style="text-align: center; margin-top: 1.25rem; font-size: 14px;">
            ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="{% url 'login' %}" class="link">ë¡œê·¸ì¸</a>
        </p>
    </div>
</div>
<script>
(function() {
    const form = document.getElementById('register-form');
    const errEl = document.getElementById('reg-error');
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        errEl.style.display = 'none';
        const fd = new FormData(form);
        const body = { email: fd.get('email'), username: fd.get('username'), password: fd.get('password') };
        try {
            const res = await fetch('/api/auth/register/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            const data = await res.json();
            if (!res.ok) {
                const msg = (data.email && data.email[0]) || (data.username && data.username[0]) || (data.password && data.password[0]) || data.detail || 'ì…ë ¥ ë‚´ìš©ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.';
                errEl.textContent = msg;
                errEl.style.display = 'block';
                return;
            }
            if (data.tokens && data.tokens.access) {
                localStorage.setItem('access', data.tokens.access);
                if (data.tokens.refresh) localStorage.setItem('refresh', data.tokens.refresh);
            }
            window.location.href = '{% url "home" %}';
        } catch (e) {
            errEl.textContent = 'ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
            errEl.style.display = 'block';
        }
    });
})();
</script>
{% endblock %}
